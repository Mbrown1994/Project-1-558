---
title: "Project 1 558"
author: "Mary Brown"
date: "10/4/2021"
output:  
  rmarkdown::github_document: 
  toc: yes  
---


## Required packages for this Project  
  * Httr  
  * jsonlite  
  * ggplot2  
  * knitr  
  * dplyr
  
## This helper function converts columns that contain numeric data stored as character values to numeric data types. I made this function first, in case I would need it moving forward.  
```{r,echo=TRUE}  
convertToNumeric<-function(vec){  
  if(any(is.na(suppressWarnings(as.numeric(vec))) == TRUE)){  
    output <- vec  
  }  
  else{  
    output<-as.numeric(vec)  
  }  
  return(output)  
}  
```


## This code chunk connects to the COVID API and converts the summary information to text, then to json, and lastly to a data frame. This was just practice to make sure the correct data could be pulled. 
```{r,echo=TRUE, message=FALSE}  
library(httr)  
library(jsonlite)  
Data<-GET("https://api.covid19api.com/total/dayone/country/south-africa")  
get_text<-(content(Data,"text"))  
get_json<-fromJSON(get_text, flatten=TRUE)  
get_df<-as.data.frame(get_json)  
```  
 

## This function returns user specified type by a user specified country: either the United States or Canada
```{r,echo=TRUE}  
UnitedCanada<-function(type="all", Country="all"){  
  outputAPI<-GET("https://api.covid19api.com/total/country/united-states")  
  data<-fromJSON(rawToChar(outputAPI$content))  
  if (type %in% c("Deaths", "Recovered", "Active", "Confirmed", "Date", "Country")){  
    if (Country == "Canada"){  
      baseurl <- "https://api.covid19api.com/total/country/"  
      fullURL <- paste0(baseurl, Country)  
      data <- fromJSON(fullURL)  
      data <- data %>% select(type)  
    }  
    else if (Country == "United States"){  
      baseurl <- "https://api.covid19api.com/total/country/"  
      fullURL <- paste0(baseurl, Country)  
      data <- fromJSON(fullURL)  
      data <- data %>% select(type)  
    }  
  }  
  return(data)  
}  
```  


## This function attempted to pull form the Status Endpoint. I was able to get it to subset for Australia confirmed cases but could not get it to subset user friendly information. 
```{r,echo=TRUE}  
StatusEndpoint<-function(type="all", Country="all"){  
  outputAPI<-GET("https://api.covid19api.com/dayone/country/australia/status/confirmed/live")  
  data<-fromJSON(rawToChar(outputAPI$content))  
  if (type %in% c("Status", "Country")){  
    if (type == "Deaths"){  
      baseurl <- "https://api.covid19api.com/dayone/country/australi/status/"  
      fullURL <- paste0(baseurl, type, "/live")  
      data<-fromJSON(fullURL)  
      data<- data %>% select(type)  
    }  
    if (type == "Confirmed"){  
      baseurl <- "https://api.covid19api.com/dayone/country/australia/status/"  
      fullURL <- paste0(baseurl, type, "/live")  
      data<-fromJSON(fullURL)  
      data<-data %>% select(type)  
    }  
    if (type == "Recovered"){  
      baseurl <- "https://api.covid19api.com/dayone/country/australia/status/"  
      fullURL<-paste0(baseurl, type, "/live")  
      data <-fromJSON(fullURL)  
      data<-data %>% select(type)  
    }   
  }
    return(data)
}
``` 
  

## Pull data from at least two endpoints. For all of the below EDA, I pulled right from the API and played around with data because I was unable to get enough information from my user friendly functions. 
```{r,echo=TRUE}  
DataPull<-GET("https://api.covid19api.com/summary")  
DataPullText<-(content(DataPull, "text"))  
JSONdatapull<-fromJSON(DataPullText, flatten=TRUE)  
SummaryData<-as.data.frame(JSONdatapull)  

DataPull2<-GET("https://api.covid19api.com/total/country/south-africa")  
DataPullText2<-(content(DataPull2, "text"))  
JSONdatapull2<-fromJSON(DataPullText2, flatten=TRUE)  
TotalSouthAfricaData<-as.data.frame(JSONdatapull2)  

DataPull3<-GET("https://api.covid19api.com/total/dayone/country/united-states")  
Datapulltext3<-(content(DataPull3, "text"))  
JSONdatapull3<-fromJSON(Datapulltext3, flatten=TRUE)  
DayOneData<-as.data.frame(JSONdatapull3)
```  

## You should create at least two new variables that are functions of the variables from a data set you use.  
```{r, echo=TRUE} 
library(dplyr)
Summary1<-mutate(SummaryData, OldConfirmed = Global.TotalConfirmed-Global.NewConfirmed, OldDeaths = Global.TotalDeaths-Global.NewDeaths)  
```  


## Create a few contingecy tables for comparison. The first one compares the Deaths in South Africa to the Deaths in the United States (since the first recorded case). The second table compares the confirmed cases in South Africa to the confirmed cases in the United States(since the first recorded case). The third table compares the amount recovered in south africa to the amount recovered in the united states(since the first recorded case). 
```{r,echo=TRUE}  
Table1<-table(TotalSouthAfricaData$Deaths, DayOneData$Deaths)
Table2<-table(TotalSouthAfricaData$Confirmed, DayOneData$Confirmed)  
Table3<- table(TotalSouthAfricaData$Recovered, DayOneData$Recovered)
```  

## Some numerical summaries for quantitative variables are shown here (averages, standard deviation, and median:  
```{r,echo=TRUE}  
SummaryData %>% summarise(avg=mean(Countries.NewConfirmed), avg2=mean(Countries.TotalConfirmed), avg3=mean(Countries.NewDeaths), avg4=mean(Countries.TotalDeaths))  

SummaryData %>% summarise(med=median(Global.NewConfirmed), med2=median(Global.TotalConfirmed), med3=median(Global.NewDeaths), med4=median(Global.TotalDeaths))  

SummaryData %>% summarise(sd1=sd(Countries.NewRecovered), sd2=sd(Countries.TotalRecovered), sd3=sd(Global.NewRecovered), sd4=sd(Global.TotalRecovered))  
```  

## This section shows the boxplots. I subsetted 21 rows and 21 columns from the summary data so that the information would look better in the boxplot. It made the data easier to read to make a smaller data frame out of the large one. One boxplot shows the Active cases for the United States while the other one shows the Active cases for South Africa. 
```{r,echo=TRUE}
library(ggplot2)  
Chart<-GET("https://api.covid19api.com/total/dayone/country/south-africa")  
Chartt<-(content(Chart, "text"))  
Charttt<-fromJSON(Chartt, flatten=TRUE)  
SouthAfrica<-as.data.frame(Charttt)  
l<-SouthAfrica[c(1:12),c(1:12)]
d<-DayOneData[c(1:12),c(1:12)]  

p<-ggplot(l, aes(x=Country, y=Active)) +  
  geom_boxplot(width=0.7, aes(fill=Country)) 
print(p)  

p2<-ggplot(d, aes(x=Country, y=Active)) + 
  geom_boxplot(width=0.7, aes(fill=Country))  
print(p2)
```  

## This second graph is boxplot that explores the total deaths by specific countries. I pulled specific countries to compare data. 
```{r,echo=TRUE} 
Graphdata<-SummaryData[c(1:21),c(1:21)]
g <- ggplot(data=Graphdata, aes(x = Countries.CountryCode, y = Countries.TotalDeaths)) +  
  geom_bar(stat = "identity", width=0.7, col = "red", fill = "pink") 
print(g)
```  


## The below graph is a histogram showing the recovered cases for the United States. I added a mean line showing the average. 
```{r,echo=TRUE}  
dd<-DayOneData[c(1:55),c(1:12)]
s<-ggplot(data=dd, aes(x=Recovered)) +  
  geom_histogram(binwidth=2, color="blue", fill="lightblue") +  
  geom_vline(aes(xintercept=mean(Recovered)),  
             color="black", linetype="dashed", size=1)
print(s)
``` 

## The below graph is a scatterplot showing the new confirmed cases within countries vs the new deaths within countries
```{r, echo=TRUE}  
q<-ggplot(data = Summary1, aes(x = Countries.NewConfirmed, y = Countries.NewDeaths)) +  
  geom_point(shape=10, color="orange") + geom_smooth(method=lm)  
print(q)
```
